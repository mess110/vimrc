#!/usr/bin/env python
# -*- coding: utf-8 -*-

import json
import urllib2
import datetime
import os
import sys

if 'CONKY_QUERY' not in os.environ:
    print 'CONKY_QUERY env variable missing'
    sys.exit(1)
if 'CONKY_APP_ID' not in os.environ:
    print 'CONKY_APP_ID env variable missing'
    sys.exit(1)

query = os.environ['CONKY_QUERY']
app_id = os.environ['CONKY_APP_ID']

url = "http://api.openweathermap.org/data/2.5/weather?q=" + query + "&units=metric&APPID=" + app_id
headers = {
  'User-Agent' : 'ConkyWeatherBot/0.1'
}

req = urllib2.Request(url, None, headers)
try:
    response = urllib2.urlopen(req)
    j = json.loads(response.read())
    if str(j['cod']) == '200':
        print str(j['name']) + ': ' + str(str(j['main']['temp']) + 'Â°C')
    else:
        print 'No Weather Info'
except urllib2.HTTPError:
    print 'Invalid APPID'
