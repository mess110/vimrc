#!/bin/bash
# shell script to replace i3status

function hour_to_icon()
{
  hour=`date +"%I"`
  case $hour in
    01)
      hour_icon="🕐"
      ;;
    02)
      hour_icon="🕑"
      ;;
    03)
      hour_icon="🕒"
      ;;
    04)
      hour_icon="🕓"
      ;;
    05)
      hour_icon="🕔"
      ;;
    06)
      hour_icon="🕕"
      ;;
    07)
      hour_icon="🕖"
      ;;
    08)
      hour_icon="🕗"
      ;;
    09)
      hour_icon="🕘"
      ;;
    10)
      hour_icon="🕙"
      ;;
    11)
      hour_icon="🕚"
      ;;
    12)
      hour_icon="🕛"
      ;;
    *)
      hour_icon="?$hour?"
      ;;
  esac
}

infinity 4 'sleep 1' | while :
do
  hour_to_icon
  date=`date +"%A %F $hour_icon %R"`
  vpn_file="/proc/sys/net/ipv4/conf/tun0"
  if [ ! -f $vpn_file ]
  then
    vpn=''
  else
    vpn='vpn '
  fi

  autolock=`i3exit showautolock`

  layout=`setxkbmap -query | grep layout | awk '{print $2}'`
  networks=`nmcli connection show --active | awk '{print $(NF-1)}' | tail -n+2 | sed 'N;s/\n/ /'`
  if [ -d "/sys/class/power_supply/BAT0" ]
  then
    battery_status=`cat /sys/class/power_supply/BAT0/status`
    battery="$battery_status 🔋"
  else
    battery="⚡"
  fi
  weather=`weather`
  volume=`i3sound`
  uptime=`awk '{print int($1/3600)":"int(($1%3600)/60)":"int($1%60)}' /proc/uptime`
  disk1=`df -h / | awk '//{print $3 "/" $2;}' | tail -n 1 | sed 's/G//g'`
  bluetooth_check=`hciconfig | awk '//{ print tolower($1)}' | tail -n 4 | head -n 1`
  if [ "$bluetooth_check" == "up" ]
  then
    bluetooth='🔵🦷   '
  else
    bluetooth=''
  fi
  echo "$vpn   $bluetooth💾 $disk1   🎹 $layout   $weather   $date   $volume$autolock" || exit 1
  sleep 5
done
