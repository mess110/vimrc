#!/bin/bash
# shell script to replace i3status

infinity 4 'sleep 1' | while :
do
  # read line
  date=`date +"%A %F %R"`
  vpn_file=`/proc/sys/net/ipv4/conf/tun0`
  if [ ! -f "$vpn_file" ]
  then
    vpn=''
  else
    vpn='vpn '
  fi

  layout=`setxkbmap -query | grep layout | awk '{print $2}'`
  # networks=`hostname -I`
  networks=`nmcli connection show --active | awk '{print $(NF-1)}' | tail -n+2 | sed 'N;s/\n/ /'`
  # enp=`ip addr show enp3s0 | grep "inet\b" | awk '{print $2}' | cut -d/ -f1`
  # eth=`ip addr show eth0 | grep "inet\b" | awk '{print $2}' | cut -d/ -f1`
  # wlan=`ip addr show wlan0 | grep "inet\b" | awk '{print $2}' | cut -d/ -f1`
  if [ -d "/sys/class/power_supply/BAT0" ]
  then
    battery_status=`cat /sys/class/power_supply/BAT0/status`
    battery="$battery_status ðŸ”‹"
  else
    battery="âš¡"
  fi
  # btc=`btc-ticker $`
  weather=`weather`
  # volume_amount=`awk -F"[][]" '/dB/ { print $2 }' <(amixer sget Master)`
  # volume="â™ª $volume_amount"
  volume=`i3sound`
  uptime=`awk '{print int($1/3600)":"int(($1%3600)/60)":"int($1%60)}' /proc/uptime`
  disk1=`df -h / | awk '//{print $3 "/" $2;}' | tail -n 1 | sed 's/G//g'`
  bluetooth_check=`hciconfig | awk '//{ print tolower($1)}' | tail -n 4 | head -n 1`
  if [ "$bluetooth_check" == "up" ]
  then
    bluetooth='ðŸ”µðŸ¦· | '
  else
    bluetooth=''
  fi
  echo "ðŸŒ $vpn$networks | $bluetoothðŸ’¾ $disk1 | ðŸŽ¹ $layout | $weather $date $volume" || exit 1
  sleep 5
done
